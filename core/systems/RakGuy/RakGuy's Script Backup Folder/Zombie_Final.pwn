#define FILTERSCRIPT
#define ZM_CIV 392
#define ZOM_INV_COL 0x17751700
#define CIV_INV_COL 0x28344E00

////////TBD from
#include <a_samp>
#include <zcmd>
#include <sscanf2>
#include <foreach>
enum TeamDet
{
    TColor
};
new Teams[6][TeamDet]=
{
{0x001233},
{0x3F3E45FF},
{0x979592FF},
{0xA5A9A7FF},
{0x231232ff},
{0x223344ff}
};
/////TBD till
new Float:Zombie_Civil_Spawn_1[100][4]=
{
{115.68277, 1952.04724, 19.13061, 0.00000},
{229.04654, 1954.59924, 17.79723, 0.00000},
{280.86838, 1924.44641, 19.76216, -40.74000},
{291.98416, 1830.58020, 17.67447, -81.66000},
{117.76749, 1952.02783, 19.18981, 0.00000},
{230.40652, 1954.69727, 17.76246, 0.00000},
{282.21585, 1923.47876, 19.76216, -40.74000},
{292.17575, 1829.26282, 17.71009, -75.47998},
{113.54155, 1952.01282, 19.05166, 0.00000},
{227.72324, 1954.50769, 17.83201, 0.00000},
{279.49646, 1925.38110, 19.76216, -40.74000},
{292.00607, 1831.68872, 17.68872, -75.47998},
{119.49438, 1951.99573, 19.34770, 0.00000},
{226.36478, 1954.46375, 17.76246, 0.00000},
{278.34955, 1926.30359, 19.76216, -40.74000},
{291.92932, 1832.94812, 17.61747, -75.47998},
{111.71979, 1952.01135, 18.95299, 0.00000},
{232.01776, 1954.76929, 17.81462, 0.00000},
{283.63733, 1922.56738, 19.76216, -40.74000},
{292.15277, 1827.99744, 17.71009, -75.47998},
{293.10684, 1828.63904, 17.71009, -80.15998},
{283.62585, 1923.94482, 19.76216, -40.74000},
{227.69820, 1955.80811, 17.76246, 0.00000},
{118.63731, 1953.09814, 19.34770, 0.00000},
{116.76440, 1953.24109, 19.34770, 0.00000},
{229.52954, 1955.88171, 17.76246, 0.00000},
{282.22180, 1924.77148, 19.76216, -40.74000},
{293.03668, 1830.01428, 17.67447, -89.33997},
{294.72800, 1831.26282, 17.67447, -84.24000},
{282.26334, 1927.26672, 19.76216, -40.74000},
{231.11530, 1955.93530, 17.76246, 0.00000},
{115.35407, 1955.45557, 19.34770, 0.00000},
{113.44276, 1955.44824, 19.34770, 0.00000},
{226.25481, 1955.74451, 17.76246, 0.06000},
{280.82361, 1928.33398, 19.76216, -40.74000},
{294.70132, 1832.59192, 17.67447, -84.78001},
{294.56528, 1834.10657, 17.67447, -92.94002},
{279.60840, 1929.15662, 19.76216, -40.74000},
{224.79417, 1955.56140, 17.76246, 0.00000},
{111.71733, 1955.45142, 19.34770, 0.00000},
{119.91833, 1955.88477, 19.34770, 0.00000},
{230.15990, 1958.83191, 17.76246, 0.00000},
{280.80164, 1929.31042, 19.76216, -40.74000},
{295.74695, 1833.59412, 17.67447, -102.71999},
{295.80273, 1832.05835, 17.67447, -87.00002},
{282.08539, 1928.44055, 19.76216, -40.74000},
{228.29436, 1958.86707, 17.76246, 0.00000},
{117.97478, 1956.03845, 19.34770, 0.00000},
{116.32767, 1956.30212, 19.34770, 0.12000},
{226.93016, 1958.75061, 17.76246, 0.00000},
{283.44080, 1927.33655, 19.76216, -40.74000},
{295.80750, 1830.66772, 17.67447, -84.72000},
{295.80402, 1829.34143, 17.67447, -81.66000},
{284.83221, 1926.34631, 19.76216, -40.74000},
{231.90799, 1958.82532, 17.76246, 0.00000},
{114.41491, 1956.35193, 19.34770, 0.00000},
{112.69670, 1956.46411, 19.34770, 0.00000},
{225.50533, 1958.80212, 17.76246, 0.00000},
{286.27826, 1925.07703, 19.76216, -40.74000},
{295.95187, 1828.00146, 17.67447, -81.66000},
{294.88846, 1828.59497, 17.67447, -81.66000},
{285.11713, 1925.09436, 19.76216, -40.74000},
{231.04335, 1957.87024, 17.76246, 0.00000},
{118.81076, 1955.15576, 19.34770, 0.00000},
{117.10316, 1955.41736, 19.34770, 0.00000},
{229.27521, 1957.68176, 17.76246, 0.00000},
{283.66916, 1926.26099, 19.76216, -40.74000},
{294.80490, 1830.16821, 17.71009, -83.99997},
{293.04965, 1831.26025, 17.67447, -84.24000},
{293.00616, 1832.58948, 17.67447, -84.78001},
{292.85312, 1834.10413, 17.67447, -92.94002},
{280.85135, 1925.73730, 19.76216, -40.74000},
{279.74469, 1926.58057, 19.76216, -40.74000},
{278.16818, 1927.59644, 19.76216, -40.74000},
{226.17072, 1957.82910, 17.76246, 0.06000},
{224.57536, 1957.79126, 17.76246, 0.00000},
{227.63123, 1957.81189, 17.76246, 0.00000},
{114.95567, 1953.31958, 19.34770, 0.00000},
{113.04036, 1953.29089, 19.34770, 0.00000},
{111.31093, 1953.27258, 19.34770, 0.00000},
{119.70841, 1953.91907, 19.34770, 0.00000},
{117.76276, 1954.05322, 19.34770, 0.00000},
{116.11350, 1954.29724, 19.34770, 0.12000},
{114.19866, 1954.32727, 19.34770, 0.00000},
{112.47823, 1954.41907, 19.34770, 0.00000},
{231.79611, 1956.76282, 17.76246, 0.00000},
{230.04686, 1956.74915, 17.76246, 0.00000},
{228.18019, 1956.76355, 17.76246, 0.00000},
{226.81483, 1956.62610, 17.76246, 0.00000},
{225.38889, 1956.65637, 17.76246, 0.00000},
{285.02444, 1923.70349, 19.76216, -40.74000},
{283.56595, 1924.95898, 19.76216, -40.74000},
{282.16187, 1925.93506, 19.76216, -40.74000},
{280.79361, 1927.02527, 19.76216, -40.74000},
{279.49695, 1927.88074, 19.76216, -40.74000},
{293.91669, 1833.57507, 17.67447, -102.71999},
{293.95419, 1832.03955, 17.67447, -87.00002},
{293.94034, 1830.64856, 17.67447, -84.72000},
{293.91837, 1829.32141, 17.67447, -81.66000},
{294.04730, 1827.98206, 17.67447, -81.66000}
};

new Float:Zombie_Civil_Spawn_2[100][4]=
{
{145.05945, 1835.19873, 21.80386, -219.83992},
{177.98967, 1832.58142, 23.86005, -277.79987},
{223.32150, 1833.71863, 23.86005, -277.79987},
{211.39009, 1810.59802, 25.19941, -277.79987},
{207.86577, 1811.54688, 22.08409, -277.79987},
{205.19463, 1811.70642, 17.76735, -175.97987},
{146.38654, 1855.87854, 24.03824, -191.51994},
{134.96469, 1877.06006, 22.51926, -191.51994},
{117.90445, 1875.22974, 22.51926, -191.51994},
{132.59116, 1900.83472, 22.86932, -191.51994},
{149.05646, 1902.96863, 25.82085, -191.51994},
{193.94270, 1929.62769, 23.24057, -191.51994},
{218.25694, 1931.76404, 23.24057, -191.51994},
{246.07834, 1862.99512, 21.46022, -191.51994},
{239.15517, 1838.70386, 23.86005, -277.79987},
{202.92101, 1835.21045, 23.86005, -277.79987},
{246.96692, 1863.14636, 21.16876, -191.51994},
{153.03835, 1837.04688, 21.80386, -266.21997},
{145.73912, 1844.84888, 24.03824, -191.51994},
{138.82927, 1873.24780, 22.51926, -191.21994},
{122.38524, 1875.00488, 22.51926, -191.45995},
{130.72145, 1906.72583, 22.86932, -191.51994},
{143.53813, 1903.14453, 26.49533, -191.33995},
{203.40248, 1933.66919, 23.24057, -191.51994},
{230.48280, 1831.42542, 23.86005, -277.79987},
{193.23280, 1831.41174, 23.86005, -277.79987},
{188.03932, 1838.16711, 23.86005, -277.79987},
{149.59578, 1834.84094, 21.80386, -266.21997},
{141.73547, 1839.14001, 21.80386, -266.21997},
{140.87778, 1850.35986, 25.38524, -191.51994},
{150.36655, 1853.48401, 24.66537, -191.51994},
{134.08696, 1871.50586, 22.51926, -191.21994},
{141.87000, 1878.93286, 22.51926, -191.21994},
{114.72359, 1870.97241, 22.51926, -191.45995},
{114.34797, 1878.82617, 22.51926, -191.45995},
{135.34785, 1895.54053, 22.99712, -191.33995},
{134.29018, 1908.38086, 22.99712, -191.33995},
{138.95139, 1898.28711, 24.96579, -191.51994},
{138.67618, 1908.32764, 24.96579, -191.51994},
{154.77623, 1908.21362, 24.55581, -191.51994},
{154.61015, 1898.61462, 24.55581, -191.51994},
{203.09052, 1928.40979, 23.24057, -191.51994},
{212.20985, 1935.64539, 23.24057, -191.51994},
{216.67113, 1927.22156, 23.24057, -191.51994},
{221.75160, 1936.62634, 23.24057, -191.51994},
{197.22353, 1935.26233, 23.24057, -191.51994},
{196.86726, 1926.44556, 23.24057, -191.51994},
{191.35315, 1935.68140, 23.24057, -191.51994},
{210.49216, 1930.20923, 23.24057, -191.51994},
{245.23724, 1862.38123, 21.16876, -191.51994},
{246.28108, 1863.70728, 21.16876, -191.51994},
{245.36736, 1862.91602, 21.16876, -191.51994},
{213.63422, 1812.85718, 25.19941, -277.79987},
{213.76602, 1809.43042, 25.19941, -277.79987},
{209.24107, 1809.02271, 25.19941, -277.79987},
{209.71767, 1813.03015, 25.19941, -277.79987},
{205.22513, 1808.03333, 17.76735, -175.97987},
{205.52730, 1815.32568, 17.76735, -175.97987},
{207.51933, 1807.80212, 22.08409, -277.79987},
{207.65094, 1814.51343, 22.08409, -277.79987},
{211.55037, 1814.79480, 22.08409, -277.79987},
{215.61720, 1814.53918, 22.08409, -277.79987},
{216.12523, 1811.60095, 22.08409, -277.79987},
{215.80356, 1807.58594, 22.08409, -277.79987},
{213.08621, 1806.87378, 22.08409, -277.79987},
{209.67851, 1806.94946, 22.08409, -277.79987},
{206.00549, 1808.49548, 22.08409, -277.79987},
{217.40082, 1808.78479, 22.08409, -277.79987},
{211.63403, 1808.56921, 25.19941, -277.79987},
{211.56949, 1813.10010, 25.19941, -277.79987},
{213.69792, 1811.41748, 25.19941, -277.79987},
{209.30072, 1811.26575, 25.19941, -277.79987},
{193.34799, 1837.20630, 23.86005, -277.79987},
{185.85007, 1831.71191, 23.86005, -277.79987},
{181.86987, 1838.28406, 23.86005, -277.79987},
{181.51707, 1830.31970, 23.86005, -277.79987},
{175.73618, 1838.07715, 23.86005, -277.79987},
{199.40169, 1829.80554, 23.86005, -277.79987},
{201.23782, 1837.81555, 23.86005, -277.79987},
{203.11302, 1831.38538, 23.86005, -277.79987},
{226.36565, 1837.66113, 23.86005, -277.79987},
{226.41975, 1829.87158, 23.86005, -277.79987},
{232.37248, 1836.45215, 23.86005, -277.79987},
{238.95163, 1830.92163, 23.86005, -277.79987},
{242.97650, 1836.05664, 23.86005, -277.79987},
{243.17657, 1829.55554, 23.86005, -277.79987},
{217.85622, 1829.43518, 23.86005, -277.79987},
{215.86151, 1832.78687, 23.86005, -277.79987},
{218.10379, 1837.59680, 23.86005, -277.79987},
{223.71201, 1838.49915, 23.86005, -277.79987},
{152.50424, 1839.39050, 21.80386, -219.83992},
{152.99365, 1833.52893, 21.80386, -219.83992},
{139.71381, 1837.76001, 21.80386, -219.83992},
{140.69267, 1833.72217, 21.80386, -219.83992},
{144.50423, 1837.73474, 21.80386, -219.83992},
{147.53477, 1832.95227, 21.80386, -219.83992},
{150.36975, 1842.64319, 24.03824, -191.51994},
{140.62218, 1842.37476, 24.03824, -191.51994},
{142.06570, 1871.08044, 22.51926, -191.21994},
{129.46532, 1895.41479, 22.86932, -191.51994}
};
new Total_Joins, Civilians[2], Zombies[2];
new bool:InZombieEvent[MAX_PLAYERS];
new bool:IsZombie[MAX_PLAYERS];
new FoCo_Event_Died[MAX_PLAYERS];
new Zombie_MSG[100];
new Event_InProgress;
new Event_ID;

public OnFilterScriptInit()
{
    Event_InProgress = 1;
	return 1;
}

stock ZombieLeaveEvent(playerid)
{
	InZombieEvent[playerid]=false;
	if(IsZombie[playerid]==false)
	{
		Zombies[1]++;
	}
	else
	{
	    Civilians[1]++;
	}
	format(Zombie_MSG, sizeof(Zombie_MSG), "Zombies : %i - %i : Civilian", Zombies[1], Civilians[1]);
	SendClientMessageToAll(COLOR_NOTICE, Zombie_MSG);
	if(Zombies[0]==Civilians[1]||Zombies[1]==Civilians[0])
	{
		if(Zombies[0]==Civilians[1]&&IsZombie[playerid]==true)
		{
		    format(Zombie_MSG, sizeof(Zombie_MSG), "Civilians won the Event.");
		}
		else
		{
		    format(Zombie_MSG, sizeof(Zombie_MSG), "Zombies won the Event.");
		}
		foreach(Player, i)
	    {
	        if(GetPVarInt(playerid, "InEvent")==1)
	        {
			    FoCo_Event_Died[i] = 0;
			    IsZombie[i]=false;
			    InZombieEvent[i]=false;
			    SetPVarInt(i, "InEvent", 0);
			    SpawnPlayer(i);
				SetPlayerColor(i, Teams[GetPVarInt(i, "TeamID")][TColor]);
			}
		}
	    Event_InProgress = 1;
		SendClientMessageToAll(COLOR_NOTICE, Zombie_MSG);
	}
	FoCo_Event_Died[playerid]=1;
	return 1;
}
stock ZoCiJoin(playerid)
{
	if(GetPVarInt(playerid, "InEvent")==0)
	{
		SetPVarInt(playerid, "InEvent", 1);
		SetPlayerVirtualWorld(playerid, 1500);
		InZombieEvent[playerid]=true;
		if(Total_Joins%2==0)
		{
			IsZombie[playerid]=true;
		    SetPlayerSkin(playerid, 0);
		    SetPlayerPos(playerid,Zombie_Civil_Spawn_1[Zombies[0]][0], Zombie_Civil_Spawn_1[Zombies[0]][1], Zombie_Civil_Spawn_1[Zombies[0]][2]+1.0);
			SetPlayerFacingAngle(playerid, Zombie_Civil_Spawn_1[Zombies[0]][3]);
			SetPlayerColor(playerid, ZOM_INV_COL);
			ResetPlayerWeapons(playerid);
			GivePlayerWeapon(playerid, 9, 1);
			SetPlayerHealth(playerid, 99.0);
			SetPlayerArmour(playerid, 99.0);
	   		Zombies[0]++;
		}
		else
		{
			IsZombie[playerid]=false;
			SetPlayerSkin(playerid, random(300)+1);
			SetPlayerPos(playerid,Zombie_Civil_Spawn_2[Civilians[0]][0], Zombie_Civil_Spawn_2[Civilians[0]][1], Zombie_Civil_Spawn_2[Civilians[0]][2]+2.0);
			SetPlayerFacingAngle(playerid, Zombie_Civil_Spawn_1[Zombies[0]][3]);
			SetPlayerColor(playerid, CIV_INV_COL);
			ResetPlayerWeapons(playerid);
			GivePlayerWeapon(playerid, 24, 100);
			GivePlayerWeapon(playerid, 31, 150);
			SetPlayerHealth(playerid, 50.0);
			SetPlayerArmour(playerid, 20.0);
			Civilians[0]++;
		}
		Total_Joins++;
	}
	else
	{
	    SendClientMessage(playerid, COLOR_WARNING, "[ERROR:] You are already in event.");
	}
	return 1;
}
public OnPlayerConnect(playerid)
{
	InZombieEvent[playerid]=false;
	FoCo_Event_Died[playerid]=0;
	IsZombie[playerid]=false;
	return 1;
}

public OnPlayerDisconnect(playerid, reason)
{
	if(InZombieEvent[playerid]==true)
	{
	    ZombieLeaveEvent(playerid);
	}
	return 1;
}

public OnPlayerDeath(playerid, killerid, reason)
{
	if(InZombieEvent[playerid]==true)
	{
	    ZombieLeaveEvent(playerid);
	}
	return 1;
}

CMD:join(playerid, params[])
{
	if(Event_InProgress == 0)
	{
   	    if(FoCo_Event_Died[playerid]==0)
	    {
			if(Event_ID == ZM_CIV)
			{
				ZoCiJoin(playerid);
			}
		}
		else
		{
		    SendClientMessage(playerid, COLOR_WARNING, "[ERROR:] You died in the event. And this event is non-rejoinable.");
		}
	}
	else
	{
	    SendClientMessage(playerid, COLOR_WARNING, "[ERROR:] There is no event in progress nigga!;");
	}
	return 1;
}

CMD:zombieevent(playerid)
{
    Zombie_EventStart(playerid);
	return 1;
}

stock Zombie_EventStart(playerid)
{
	new string[138];
	foreach(Player, i)
    {
	    FoCo_Event_Died[i] = 0;
	    SetPVarInt(i, "InEvent", 0);
    }
    format(string, sizeof(string), "[EVENT]: %s %s has started {%06x}Zombie vs Civlian {%06x}event.  Type /join!", GetPlayerStatus(playerid), PlayerName(playerid), COLOR_WARNING >>> 8, COLOR_NOTICE >>> 8);
    SendClientMessageToAll(COLOR_NOTICE, string);
    Civilians[0]=Civilians[1]=Zombies[1]=Zombies[0]=0;
    Event_InProgress = 0;
	Event_ID = ZM_CIV;
    //IRC_GroupSay(gLeads, IRC_FOCO_LEADS, string);
    return 1;
}

CMD:eventclear(playerid)
{
	InZombieEvent[playerid]=false;
	FoCo_Event_Died[playerid]=0;
	IsZombie[playerid]=false;
	SetPVarInt(playerid, "InEvent", 0);
	return 1;
}
CMD:help(playerid)
{
	SendClientMessageToAll(-1, "/eventclear, /zombieevent, /join");
	return 1;
}

